<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width"/>
    <meta charset="UTF-8">
    <title>Leaderboard</title>
</head>

<body onload="getLeaderboard();">
<div>
    <h3 id="endMessage"></h3>
    <ol id="leaderboard"></ol>
</div>


<script>
    const API_LEADERBOARD = "https://codecyprus.org/th/api/leaderboard";
    let leaderboardElement= document.getElementById("leaderboard");

    function getLeaderboard(){
        fetch(API_LEADERBOARD+"?session="+getCookie("sessionID")+"&sorted&limit=20")
            .then(response => response.json())
            .then(jsonObject =>
            {
                let leaderboardArry =jsonObject.leaderboard;
                for (let i = 0; i < jsonObject.limit; i++) {
                    let listleaderboard = document.createElement("li");
                    listleaderboard.innerHTML = "<b>Name: </b>" + leaderboardArry[i].player + "<b> Score: </b>" + leaderboardArry[i].score + "<b> Completed in: </b>" + convert2date(leaderboardArry[i].completionTime);
                    leaderboardElement.appendChild(listleaderboard);

                }
            });
    }

    function convert2date(ms){
        let date = new Date(ms);
        return date.toString();
    }

    function getCookie(cookieName) {
        let name = cookieName + "=";
        let decodedCookie = decodeURIComponent(document.cookie);
        let ca = decodedCookie.split(';');
        for (let i = 0; i < ca.length; i++) {
            let c = ca[i];
            while (c.charAt(0) === ' ') {
                c = c.substring(1);
            }
            if (c.indexOf(name) === 0) {
                return c.substring(name.length, c.length);
            }
        }
        return "";
    }// const params = new URLSearchParams(location.search);


</script>

</body>

</html>