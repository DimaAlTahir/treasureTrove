<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width"/>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="stylesheet.css">
    <title>Title</title>

</head>
<body>

 <div class="container">

     <div id="quizQuestionContainer">
         <p id="question"></p>  <!--Leave it empty -->
     </div>

     <div class="answer" id="textboxContainer">
         <form action="javascript:answerText()">
             <input id="textBox" class="answer" type="text" name="answer">
             <input id="buttonText" class="controlbtns" type="submit" value="Submit">
         </form>
      </div>

     <div class="answer" id="numericContainer">
         <form action="javascript:answerNum()">
             <input id="number" class="answer" type="number" name="answer">
             <input id="buttonNumeric" class="controlbtns" type="submit" value="Submit">
         </form>
     </div>

     <div class="answer" id="intContainer">
         <form action="javascript:answerInt()">
             <input id="int" class="answer" type="int" name="answer">
             <input id="buttonInt" class="controlbtns" type="submit" value="Submit">
         </form>
     </div>

     <div class="answer" id="booleanContainer">
             <button id="buttonTrue" class="controlbtns" value="True" onclick="trueAns()">True</button>
             <button id="buttonFalse" class="controlbtns" value="False" onclick="falseAns()">False</button>
     </div>

     <div> class="answer" id="MCQContainer">
         <button id="buttonA" class="controlbtns" value="A" >True </button>
         <button id="buttonB" class="controlbtns" value="B" >False</button>
         <button id="buttonC" class="controlbtns" value="C" >True </button>
         <button id="buttonD" class="controlbtns" value="D" >False</button>
     </div>

 </div>

     <form  action="javascript:skipQuestion()">
         <input class="answer"  id="skip" type="submit" value="Skip" />
     </form>

<script>

    const API_QUESTIONS="https://codecyprus.org/th/api/question";
    const API_START="https://codecyprus.org/th/api/start";
    const params = new URLSearchParams(location.search);
    let playerName = params.get("player");
    let uuid = params.get("treasure-hunt-id");
    console.log("playerName:"+playerName);
    console.log("uuid:"+uuid);

    startGame();

    function startGame(){
        document.getElementById("question").innerText="Loading....";
        fetch(API_START + "?player="+playerName+"&app=TreasureTrove&treasure-hunt-id="+uuid)
            .then(response => response.json())
            .then(jsonObject =>
            {
                console.log(jsonObject.status);
                if (jsonObject.status ==="ERROR"){
                    document.getElementById("question").innerHTML= jsonObject.errorMessages[0] + "<br>" + "<a href='Signin.html'> Click this Link to Sign again</a>";
                }else if(jsonObject.status ==="OK"){
                    saveCookie("sessionID",jsonObject.session,360);
                    saveCookie("numOfQuestions",jsonObject.numOfQuestions,360);
                    // console.log( getCookie("sessionID"));
                    // console.log( getCookie("numOfQuestions"));
                    getQuestions();
                }

            });
    }

    function getQuestions(){
        fetch(API_QUESTIONS+"?session="+getCookie("sessionID"))
            .then(response => response.json())
            .then(jsonObject =>
            {
                console.log(jsonObject.status);
                if (jsonObject.status ==="ERROR"){
                    document.getElementById("question").innerHTML= jsonObject.errorMessages[0] + "<br>" + "<a href='Signin.html'> Click this Link to Sign again</a>";
                }else if(jsonObject.status ==="OK"){
                    document.getElementById("question").innerHTML= "<p>"+ jsonObject.questionText +"</p>";
                    switch (jsonObject.questionType) {
                        case "INTEGER":
                            document.getElementById("numericContainer").style.display='none';
                            document.getElementById("intContainer").style.display='block';
                            document.getElementById("textboxContainer").style.display='none';
                            document.getElementById("booleanContainer").style.display='none';
                            document.getElementById("MCQContainer").style.display='none';
                            break;

                        case "NUMERIC":
                            document.getElementById("numericContainer").style.display='block';
                            document.getElementById("intContainer").style.display='none';
                            document.getElementById("textboxContainer").style.display='none';
                            document.getElementById("booleanContainer").style.display='none';
                            document.getElementById("MCQContainer").style.display='none';
                            break;

                        case "BOOLEAN":
                            document.getElementById("numericContainer").style.display='none';
                            document.getElementById("intContainer").style.display='none';
                            document.getElementById("intContainer").style.display='none';
                            document.getElementById("booleanContainer").style.display='block';
                            document.getElementById("MCQContainer").style.display='none';
                            break;

                        case "MCQContainer":
                            document.getElementById("numericContainer").style.display='none';
                            document.getElementById("intContainer").style.display='none';
                            document.getElementById("intContainer").style.display='none';
                            document.getElementById("booleanContainer").style.display='none';
                            document.getElementById("MCQContainer").style.display='block';
                            break;

                        case "TEXT":
                            document.getElementById("numericContainer").style.display='none';
                            document.getElementById("intContainer").style.display='none';
                            document.getElementById("intContainer").style.display='none';
                            document.getElementById("booleanContainer").style.display='none';
                            document.getElementById("MCQContainer").style.display='block';
                    }

                }
            });
    }

    // {
    //     "session": "ag9nfmNvZGVjeXBydXNvcmdyFAsSB1Nlc3Npb24YgICA3JfiuQsM",
    //     "numOfQuestions": 6,
    //     "status": "OK"
    // }


    //functions to find device location
    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition);
        }
        else {
            alert("Geolocation is not supported by your browser.");
        }
    }
    function showPosition(position) {
        alert("Latitude: " + position.coords.latitude + ", Longitude: " + position.coords.longitude);
    }




    //function to skip questions
    function skipQuestion() {
        fetch("https://codecyprus.org/th/api/question")
            .then(response => response.json())
            .then(jsonObject => {
                let current = jsonObject.currentQuestionIndex;
                for (let i = 0; i < treasureHuntsArray.length; i++) {
                    if (numOfQuestions[i] === current) {
                        continue;
                    }
                }
            });
    }






    //function that writes question then decides the way 2 answer
    // function displayQuestionReply(){
    //     document.getElementsById(question).innerHTML=json.questionText;
    //     if (json.questionType==='BOOLEAN'){
    //         document.getElementById(submitBtn).style.display='none';
    //         document.getElementById(boolBtnT).style.display='grid';
    //         document.getElementById(boolBtnF).style.display='grid';
    //     }
    //     else if (json.questionType ==='TEXT'){
    //         document.getElementById(submitBtn).style.display='grid';
    //         document.getElementById(boolBtnT).style.display='none';
    //         document.getElementById(boolBtnF).style.display='none';
    //     }
    //     else if (json.questionType==='INTEGER'){
    //         document.getElementById(submitBtnInt).style.display='grid';
    //         document.getElementById(submitBtn).style.display='none';
    //         document.getElementById(boolBtnT).style.display='none';
    //         document.getElementById(boolBtnF).style.display='none';
    //     }
    //     else if (json.questionType==='NUMERIC'){
    //         document.getElementById(submitBtnNumeric).style.display='grid';
    //         document.getElementById(submitBtnInt).style.display='none';
    //         document.getElementById(submitBtn).style.display='none';
    //         document.getElementById(boolBtnT).style.display='none';
    //         document.getElementById(boolBtnF).style.display='none';
    //     }
    //     else{
    //         document.getElementById(submitBtnNumeric).style.display='none';
    //         document.getElementById(submitBtnInt).style.display='none';
    //         document.getElementById(submitBtn).style.display='none';
    //         document.getElementById(boolBtnT).style.display='none';
    //         document.getElementById(boolBtnF).style.display='none';
    //     }
    //
    // }

    function answerText(){
        let a=document.getElementById("textBox").value;
        loadAns(a);
    }

    function answerNum(){
        let a=document.getElementById("number").value;
        loadAns(a);
    }

    function answerInt(){
        let a=document.getElementById("int").value;
        loadAns(a);
    }

    function trueAns(){
        loadAns('true');
    }
    function falseAns(){
        loadAns('false');
    }

    function loadAns(a){
        console.debug("submitted: "+a)
        //todo send answer 2 server by api
    }

    function saveCookie(cookieName, cookieValue, expireDays) {
        let d = new Date();
        d.setTime(d.getTime() + (expireDays*24*60*60*1000));
        let expires = "expires="+ d.toUTCString();
        document.cookie = cookieName + "=" + cookieValue + ";" + expires;
    }

    function getCookie(cookieName) {
        let name = cookieName + "=";
        let decodedCookie = decodeURIComponent(document.cookie);
        let ca = decodedCookie.split(';');
        for(let i = 0; i <ca.length; i++) {
            let c = ca[i];
            while (c.charAt(0) === ' ') {
                c = c.substring(1);
            }
            if (c.indexOf(name) === 0) {
                return c.substring(name.length, c.length);
            }
        }
        return "";
    }
</script>




</body>
</html>